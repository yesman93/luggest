Object.defineProperty(window,"Luggest",{configurable:!1,enumerable:!1,get:function(){let e=null;return function(){return e||(e={_instances:{},get instances(){return this._instances},default_min_length:1,init:function(e,t){const n=this._resolve_element(e);if(!n)return console.error("[Luggest] Target element not found for:",e),null;if(!n.id)return console.error("[Luggest] Element must have an id attribute to use Luggest.",n),null;const i=n.id;if(this._instances[i])return this._instances[i];const s=t||{},o=this._create_instance(n,s);return this._instances[i]=o,n.dataset.luggest="1",o},get:function(e){return this._instances[e]||null},destroy:function(e){const t=this._instances[e];t&&"function"==typeof t.destroy&&t.destroy()},_resolve_element:function(e){return e instanceof HTMLElement?e:"string"==typeof e?document.querySelector(e):null},_normalize_item:function(e){if(e&&"object"==typeof e){const t=null!=e.value?String(e.value):null!=e.label?String(e.label):"";return{value:t,label:null!=e.label?String(e.label):t,metadata:Object.prototype.hasOwnProperty.call(e,"metadata")?e.metadata:null}}const t=String(e);return{value:t,label:t,metadata:null}},_normalize_list:function(e){if(!Array.isArray(e))return[];const t=[];for(let n=0;n<e.length;n++)t.push(this._normalize_item(e[n]));return t},_resolve_source:function(t,n,i){const s=(n||"").toLowerCase();if(Array.isArray(t)){const e=Array.isArray(i)?i:this._normalize_list(t);if(!s)return Promise.resolve(e);const n=e.filter(function(e){const t=(e.label||"").toLowerCase(),n=(e.value||"").toLowerCase();return-1!==t.indexOf(s)||-1!==n.indexOf(s)});return Promise.resolve(n)}if("string"==typeof t&&t.length>0){const i=-1!==t.indexOf("?"),s=t+(i?"&":"?")+"term="+encodeURIComponent(n);return fetch(s,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json"}}).then(function(e){return e.json()}).then(function(t){return Array.isArray(t)?e._normalize_list(t):[]}).catch(function(e){return console.error("[Luggest] Error loading suggestions:",e),[]})}return Promise.resolve([])},_create_instance:function(e,t){const n=this,i={id:e.id,element:e,options:{source:t.source||[],min_length:"number"==typeof t.min_length&&t.min_length>=0?t.min_length:n.default_min_length,on_open:"function"==typeof t.on_open?t.on_open:null,on_select:"function"==typeof t.on_select?t.on_select:null,max_results:"number"==typeof t.max_results?t.max_results:20},_container:null,_items:[],_is_open:!1,_highlight_index:-1,_last_query:"",_array_source_normalized:Array.isArray(t.source)?n._normalize_list(t.source):null,_pending_request_token:0,_bound_on_input:null,_bound_on_focus:null,_bound_on_keydown:null,_bound_on_document_click:null,_bound_on_resize:null,close:function(){this._is_open&&(this._container&&(this._container.style.display="none",this._container.innerHTML=""),this._is_open=!1,this._highlight_index=-1)},destroy:function(){this.close(),this._unbind_events(),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this.element&&this.element.dataset&&delete this.element.dataset.luggest,n._instances&&this.id&&n._instances[this.id]&&delete n._instances[this.id]},_ensure_container:function(){if(this._container)return;const e=document.createElement("div");e.className="luggest-dropdown",e.style.position="absolute",e.style.display="none",e.style.zIndex="9999",document.body.appendChild(e),this._container=e},_position_container:function(){if(!this._container||!this.element)return;const e=this.element.getBoundingClientRect();this._container.style.minWidth=e.width+"px",this._container.style.top=e.bottom+window.scrollY+"px",this._container.style.left=e.left+window.scrollX+"px"},_render_items:function(e){this._ensure_container();const t=this._container;if(t.innerHTML="",!e||!e.length)return void this.close();this._position_container();const n=document.createDocumentFragment(),i=Math.min(e.length,this.options.max_results);for(let t=0;t<i;t++){const i=e[t],s=document.createElement("div");s.className="luggest-item",s.textContent=i.label,s.dataset.index=String(t),s.addEventListener("mousedown",e=>{e.preventDefault(),this._select_item(t)}),n.appendChild(s)}t.appendChild(n),t.style.display="block",this._is_open=!0,this._highlight_index=-1,"function"==typeof this.options.on_open&&this.options.on_open(this.element,e)},_handle_input:function(e){const t=this.element.value||"";if(this._last_query=t,t.length<this.options.min_length)return void this.close();const i=++this._pending_request_token;n._resolve_source(this.options.source,t,this._array_source_normalized).then(e=>{i===this._pending_request_token&&(this._items=e||[],this._render_items(this._items))})},_set_highlight:function(e){if(!this._container)return;const t=this._container.querySelectorAll(".luggest-item");for(let n=0;n<t.length;n++){const i=t[n];n===e?i.classList.add("is-active"):i.classList.remove("is-active")}this._highlight_index=e},_handle_keydown:function(e){if(!this._is_open||!this._items.length)return;const t=e.key;if("ArrowDown"===t||"Down"===t){e.preventDefault();const t=(this._highlight_index+1)%this._items.length;this._set_highlight(t)}else if("ArrowUp"===t||"Up"===t){e.preventDefault();const t=(this._highlight_index-1+this._items.length)%this._items.length;this._set_highlight(t)}else"Enter"===t?this._highlight_index>=0&&this._highlight_index<this._items.length&&(e.preventDefault(),this._select_item(this._highlight_index)):"Escape"!==t&&"Esc"!==t||this.close()},_handle_focus:function(){0===this.options.min_length&&this._handle_input()},_handle_document_click:function(e){const t=e.target;t!==this.element&&(this._container&&this._container.contains(t)||this.close())},_select_item:function(e){const t=this._items[e];t&&(this.element.value=t.value,"function"==typeof this.options.on_select&&this.options.on_select(this.element,t),this.close())},_bind_events:function(){this._bound_on_input=this._handle_input.bind(this),this._bound_on_focus=this._handle_focus.bind(this),this._bound_on_keydown=this._handle_keydown.bind(this),this._bound_on_document_click=this._handle_document_click.bind(this),this._bound_on_resize=this._position_container.bind(this),this.element.addEventListener("input",this._bound_on_input),this.element.addEventListener("focus",this._bound_on_focus),this.element.addEventListener("keydown",this._bound_on_keydown),document.addEventListener("click",this._bound_on_document_click),window.addEventListener("resize",this._bound_on_resize)},_unbind_events:function(){this._bound_on_input&&this.element.removeEventListener("input",this._bound_on_input),this._bound_on_focus&&this.element.removeEventListener("focus",this._bound_on_focus),this._bound_on_keydown&&this.element.removeEventListener("keydown",this._bound_on_keydown),this._bound_on_document_click&&document.removeEventListener("click",this._bound_on_document_click),this._bound_on_resize&&window.removeEventListener("resize",this._bound_on_resize),this._bound_on_input=null,this._bound_on_focus=null,this._bound_on_keydown=null,this._bound_on_document_click=null,this._bound_on_resize=null}};return i._bind_events(),i}},e)}}()});